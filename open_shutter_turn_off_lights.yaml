blueprint:
  name: Open shutters if daylight (supports binary or numeric sensors)
  description: >
    Opens shutters when selected lights are on for a set duration or when the light sensor detects daylight.
    Supports both binary daylight sensors and numeric illuminance sensors with threshold configuration.
    Runs only if custom conditions are met (e.g., holiday/night mode off). After opening, turns off lights.
  domain: automation

  input:
    lights:
      name: Lights
      description: Lights that trigger the automation.
      selector:
        entity:
          domain: light

    light_sensor:
      name: Light Sensor
      description: Binary or numeric sensor indicating daylight or brightness.
      selector:
        entity:
          domain:
            - binary_sensor
            - sensor

    sensor_type:
      name: Sensor Type
      description: Choose whether the selected light sensor is binary or numeric.
      default: binary
      selector:
        select:
          options:
            - binary
            - numeric

    brightness_threshold:
      name: Brightness Threshold (for numeric sensors)
      description: >
        For numeric illuminance sensors, the lux value above which the shutter opens.
        Ignored if sensor type is binary.
      default: 300
      selector:
        number:
          min: 0
          max: 5000
          unit_of_measurement: lux
          mode: slider

    shutter:
      name: Shutter
      description: Cover entity to open.
      selector:
        entity:
          domain: cover

    light_on_duration:
      name: Light On Duration
      description: How long the lights must stay on before triggering.
      default: "00:00:30"
      selector:
        text:

    daylight_duration:
      name: Daylight Duration
      description: How long daylight must be detected before triggering.
      default: "00:01:00"
      selector:
        text:

    extra_conditions:
      name: Extra Conditions (optional)
      description: >
        Add one or more extra conditions that must be true for the automation to run (e.g., holiday mode off).
      default: []
      selector:
        condition: {}

triggers:
  - alias: Light on
    platform: state
    entity_id: !input lights
    to: "on"
    for: !input light_on_duration

  # Binary sensor daylight trigger
  - alias: Daylight detected (binary sensor)
    platform: state
    entity_id: !input light_sensor
    from: "off"
    to: "on"
    for: !input daylight_duration
    enabled: "{{ is_state_attr('blueprint.input.sensor_type', 'value', 'binary') }}"

  # Numeric sensor brightness threshold trigger
  - alias: Brightness above threshold (numeric sensor)
    platform: numeric_state
    entity_id: !input light_sensor
    above: !input brightness_threshold
    for: !input daylight_duration
    enabled: "{{ is_state_attr('blueprint.input.sensor_type', 'value', 'numeric') }}"

conditions:
  - condition: and
    conditions: !input extra_conditions

actions:
  - alias: Open shutter
    service: cover.open_cover
    entity_id: !input shutter

  - delay: "00:00:10"

  - alias: Turn off lights
    service: light.turn_off
    entity_id: !input lights

mode: single
